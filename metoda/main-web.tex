% This variant is used for web PDF version of the book.
% Can be compied with XelaTeX:
% * TL 2013 or later

\documentclass[a5paper,11pt,twoside,titlepage, numbers=endperiod]{scrbook}
%\documentclass[a4paper,10pt,twoside,titlepage]{book} % swap for latex2rtf

\input{main-version}

\tolerance=9999 % let the text underfull be ugly as hell, nobody cares.

\widowpenalty=9998 % try to avoid widow lines
\clubpenalty=9998 % try to avoid orphan lines
\emergencystretch=3cm

% A switch to change between document rendering options
\usepackage{etoolbox}
\newtoggle{webpaper}
\toggletrue{webpaper}

\newtoggle{hasquiz} % An option to add quizes at the end of each chapter.
\togglefalse{hasquiz}
\toggletrue{hasquiz}

\newtoggle{showanswers} % An option to show answers in quizes.
\togglefalse{showanswers}

\newtoggle{inappendix} % we are now in appendix
\togglefalse{inappendix} % ... but not yet

\usepackage[top=2.0cm, bottom=2.0cm, left=1.84cm, right=1.5cm, footskip=1cm]{geometry}

\input{setup-fonts}
\input{main-packages}
\input{setup-appendix}
\input{setup-biblio}
\input{setup-hacks}

\title{Программное моделирование вычислительных систем}
\date{\today}

\iftoggle{hasquiz}{\input{examp-dummy}}{}
\pagestyle{plain} % no headers, page numbers in footers

\begin{document}

\makeatletter\renewcommand\@biblabel[1]{#1.}\makeatother

\iftoggle{webpaper}{
    \include{title}
} {
    \include{title-print}
    \include{backside}
}

\iftoggle{webpaper}{
    \tableofcontents
} {
    % Put TOC to the end.
}

\include{contrib}

\include{overview}

\include{chapter01}

\include{chapter03}

\include{chapter04}

\include{chapter05}
 
\include{chapter07}

\include{chapter08}

\include{chapter09}

\include{chapter10}

\include{chapter11}

\include{chapter12}

\include{chapter13}

\include{chapter14}

\include{afterword}

\iftoggle{hasquiz}{
    \toggletrue{inappendix}
    \appendix
    \appendixpage
    \toggletrue{showanswers}
    \input{examp-dummy}
    \include{appendix-answers}

    \include{chapter06}     % Chapter 6 has been demoted to an appendix
    \include{ic-route}     
}{
    % No appendix if no quiz.
}

\iftoggle{webpaper}{
    % Changelog here
    \input{history.tex}
}{} % Nothing for printed version

\iftoggle{webpaper}{
    % No bibliography for the web version
    % Per chapter entries are already in place
    \include{todo}
    \phantomsection\label{page:lastpage}
} {
    \include{literature}
    \tableofcontents
    \include{lastpage}
}
\end{document}
