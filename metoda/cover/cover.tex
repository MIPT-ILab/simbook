% A cover page design attempt
% Author: 2014 Grigory Rechistov
% Build with XeLaTeX 2013, updated to March 2014 or later

\documentclass[a5paper,11pt,oneside ]{article}

% A switch to change between document rendering options
\usepackage{etoolbox}

\newtoggle{webpaper}
\toggletrue{webpaper} % Must be true for Web-PDF

\newtoggle{inappendix} % we are now in appendix
\togglefalse{inappendix} % ... but not yet

% TODO two covers+spine
\usepackage[top=0.0cm, bottom=0.0cm, left=0cm, right=0.0cm, footskip=0cm]{geometry}
\pagestyle{empty} % no headers, page numbers in footers

\input{../setup-web-fonts}
\input{../setup-packages}

\newfontfamily\titlefont[]{DejaVu Sans ExtraLight}
\newfontfamily\srcfont[]{DejaVu Sans Mono}

\begin{document}

% The front cover
\centering
\begin{tikzpicture}[inner sep=0pt]
% The page border clipping
\clip[] (current page.north west) -- (current page.south west) -- (current page.south east) -- (current page.north east) -- cycle;
    
\begin{scope}
% The source code on the left
% Source adopted from file: bochs-20140303/cpu/fetchdecode.cc:1281
\clip[] (current page.north west) -- (current page.south west) -- (current page.south) -- cycle;
\node[
        align=left, 
        text=black!50,
        font=\Large\srcfont, 
        anchor = north west,         
    ] at (current page.north west) {
\#define SSE_PREFIX_NONE 0\\
\#define SSE_PREFIX_66   1\\
\#define SSE_PREFIX_F3   2\\
\#define SSE_PREFIX_F2   3\\
  unsigned sse_prefix = SSE_PREFIX_NONE;\\
\\
  bx_bool vex_w = 0;\\
\#if BX_SUPPORT_AVX\\
  int had_vex_xop = 0, vvv = -1;\\
  bx_bool use_vvv = 0;\\
\#endif\\
\#if BX_SUPPORT_EVEX\\
\  bx_bool displ8 = 0;\\
\#endif\\
\\
  os_32 = is_32 = fetchModeMask \& BX_FETCH_MODE_IS32_MASK;\\
\\
  i->ResolveModrm = 0;\\
  i->init(/*os32*/ is_32,  /*as32*/ is_32,\\
          /*os64*/     0,  /*as64*/     0);\\
\\

% This chunk is from the same file, line 1980
  \#if BX_SUPPORT_EVEX \\
  if ((op_flags \& BX_PREPARE_EVEX) != 0 \&\& i->getEvexb()) \{\\
\ \   if (mod_mem) \{\\
\ \ \ \   if ((op_flags \& BX_PREPARE_EVEX_NO_BROADCAST) == BX_PREPARE_EVEX_NO_BROADCAST) \{\\
\ \ \ \   BX_DEBUG(("\%s: broadcast is not supported for this instruction", i->getIaOpcodeNameShort()));\\
\ \ \ \   i->execute1 = \&BX_CPU_C::BxError;\\
\ \   \}\\
    \}\\
     else \{\\
\ \       if ((op_flags \& BX_PREPARE_EVEX_NO_SAE) == BX_PREPARE_EVEX_NO_SAE) \{\\
\ \ \ \   BX_DEBUG(("\%s: EVEX.b in reg form is not allowed for instructions which cannot cause floating point exception", i->getIaOpcodeNameShort()));\\
\ \ \ \   i->execute1 = \&BX_CPU_C::BxError;\\
\ \   \}\\
    \} \\
  \}\\
}; % node
\end{scope}

\begin{scope}
% The PCB on the right. Image credit: myself.
\clip[] (current page.north) -- (current page.south east) -- (current page.north east) -- cycle;
\node[anchor = north west] at (current page.north) {\includegraphics[height=21cm]{rpi.jpg}};
\end{scope}

% The book title
\node[
      align = flush left, 
      anchor=center,
      yshift=1cm,
%       fill = white,
      font=\Huge\titlefont] at (current page.center) { Программное \\моделирование\\ вычислительных\\ систем};
\end{tikzpicture}
    
\clearpage

% The back cover
\centering
\begin{tikzpicture}[inner sep=0pt]
% The page border clipping
\clip[] (current page.north west) -- (current page.south west) -- (current page.south east) -- (current page.north east) -- cycle;
    
\begin{scope}
% The disassembly code on the left
% The objdump is taken from dosbox 0.74 built for linux64 
\clip[] (current page.north west) -- (current page.south west) -- (current page.south) -- cycle;
\node[
        align=left, 
        text=black!50,
        font=\Large\srcfont, 
        anchor = north west,         
    ] at (current page.north west) {
bf 01 00 00 00          mov    \$0x1,\%edi
\\c7 05 e7 29 45 00 00    movl   \$0x0,0x4529e7(\%rip)        \# 85bf60 <_ZTTSt14basic_ifstreamIcSt11char_traitsIcEE+0x60>
\\00 00 00 
\\e8 e2 d9 ff ff          callq  406f60 <SDL_Delay@plt>
\\e8 5d dd ff ff          callq  4072e0 <SDL_GetTicks@plt>
\\03 1d af 29 45 00       add    0x4529af(\%rip),\%ebx        \# 85bf38 <_ZTTSt14basic_ifstreamIcSt11char_traitsIcEE+0x38>
\\31 c9                   xor    \%ecx,\%ecx
\\29 c3                   sub    \%eax,\%ebx
\\85 db                   test   \%ebx,\%ebx
\\89 1d a3 29 45 00       mov    \%ebx,0x4529a3(\%rip)        \# 85bf38 <_ZTTSt14basic_ifstreamIcSt11char_traitsIcEE+0x38>
\\0f 89 cd fe ff ff       jns    409468 <_ZNSt15basic_streambufIcSt11char_traitsIcEED2Ev@plt+0x1658>
\\c1 fa 0c                sar    \$0xc,\%edx
\\44 29 c2                sub    \%r8d,\%edx
\\41 89 f0                mov    \%esi,\%r8d
\\0f af d6                imul   \%esi,\%edx
\\89 d0                   mov    \%edx,\%eax
\\31 d2                   xor    \%edx,\%edx
\\f7 f1                   div    \%ecx
\\8b 15 1d 95 42 00       mov    0x42951d(\%rip),\%edx        \# 832b04 <_fini+0x25d618>
\\48 63 ca                movslq \%edx,\%rcx
\\4c 0f af c1             imul   \%rcx,\%r8
\\4d 85 c0                test   \%r8,\%r8
\\7e 75                   jle    409668 <_ZNSt15basic_streambufIcSt11char_traitsIcEED2Ev@plt+0x1858>
\\f2 49 0f 2a c8          cvtsi2sd \%r8,\%xmm1
\\f2 48 0f 2a 05 37 32    cvtsi2sdq 0x453237(\%rip),\%xmm0        \# 85c838 <_ZTTSt14basic_ifstreamIcSt11char_traitsIcEE+0x938>
\\45 00 
\\f2 0f 5e c1             divsd  \%xmm1,\%xmm0
\\f2 0f 10 0d 1b d8 1c    movsd  0x1cd81b(\%rip),\%xmm1        \# 5d6e28 <_fini+0x193c>
\\00 
\\66 0f 2e c8             ucomisd \%xmm0,\%xmm1
\\76 55                   jbe    409668 <_ZNSt15basic_streambufIcSt11char_traitsIcEED2Ev@plt+0x1858>
\\f2 0f 2a d0             cvtsi2sd \%eax,\%xmm2
\\f2 0f 5c c8             subsd  \%xmm0,\%xmm1
\\81 fe f9 00 00 00       cmp    \$0xf9,\%esi
\\f2 0f 59 d1             mulsd  \%xmm1,\%xmm2
\\f2 0f 2c c2             cvttsd2si \%xmm2,\%eax
\\0f 86 a5 00 00 00       jbe    4096d4 <_ZNSt15basic_streambufIcSt11char_traitsIcEED2Ev@plt+0x18c4>
\\3d 00 50 00 00          cmp    \$0x5000,\%eax
\\0f 8e 9a 00 00 00       jle    4096d4 <_ZNSt15basic_streambufIcSt11char_traitsIcEED2Ev@plt+0x18c4>
\\83 ff 09                cmp    \$0x9,\%edi
\\0f 8f 91 00 00 00       jg     4096d4 <_ZNSt15basic_streambufIcSt11char_traitsIcEED2Ev@plt+0x18c4>

}; % node
\end{scope}

\begin{scope}
% The schematics on the right. Image credit: myself
\clip[] (current page.north) -- (current page.south east) -- (current page.north east) -- cycle;
\node[anchor = north west] at (current page.north) {\includegraphics[height=21cm]{schematic.jpg}};
\end{scope}

\end{tikzpicture}

\end{document}
